{{define "sidebar"}}
<aside class="w-64 bg-white border-r shadow-md hidden md:block h-screen overflow-y-auto" id="sidebar">
  <div class="p-6 text-xl font-bold text-blue-600">관리자 메뉴</div>

  <nav class="px-4" id="sidebar-app" v-cloak>
    <ul class="space-y-2 text-sm">
      <li>
        <a :class="linkClass('/adm/dashboard')" href="/adm/dashboard" class="sidebar-link">대시보드</a>
      </li>

      {{range .Menus}}
      <li>
        <button
          @click="toggleMenu('{{.Key}}')"
          class="flex items-center justify-between w-full px-3 py-2 font-semibold text-gray-700 hover:bg-blue-50"
        >
          <span>{{.Label}}</span>
          <span :class="rotateIcon('{{.Key}}')">→</span>
        </button>
        <ul v-show="isOpen('{{.Key}}')" class="ml-4 mt-1 space-y-1">
          {{range .Items}}
          <li>
            <a :class="linkClass('{{.Href}}')" href="{{.Href}}" class="sidebar-link">
              <span>{{.Label}}</span>
            </a>
          </li>
          {{end}}
        </ul>
      </li>
      {{end}}

      <li>
        <a :class="linkClass('/adm/settings')" href="/adm/settings" class="sidebar-link">설정</a>
      </li>

      <li>
        <a href="/adm/manage/logout" class="block px-3 py-2 text-red-500 hover:text-red-700">로그아웃</a>
      </li>
    </ul>
  </nav>
</aside>

<style>
  [v-cloak] {
    display: none;
  }

  .sidebar-link {
    @apply block px-3 py-2 rounded hover:bg-blue-50;
  }

  .active-link {
    @apply bg-blue-100 text-blue-700 font-semibold;
  }

  .rotate-90 {
    transform: rotate(90deg);
  }
</style>

<script>
  const { createApp, reactive } = Vue;

  createApp({
    setup() {
      const state = reactive({
        openMenu: '',
        currentPath: window.location.pathname,
      });

      const toggleMenu = (key) => {
        state.openMenu = state.openMenu === key ? '' : key;
      };

      const isOpen = (key) => state.openMenu === key;

      const rotateIcon = (key) => ({
        'transition-transform': true,
        'rotate-90': isOpen(key),
      });

      const linkClass = (href) => [
        'sidebar-link',
        state.currentPath === href ? 'active-link' : '',
      ];

      return {
        toggleMenu,
        isOpen,
        rotateIcon,
        linkClass,
      };
    }
  }).mount("#sidebar-app");
</script>
{{end}}
